{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NOVO OPERATIVO // WIZARD</title>
    
    <link rel="stylesheet" href="{% static 'runner_sheet/css/base.css' %}">
    <link rel="stylesheet" href="{% static 'runner_sheet/css/layout.css' %}">
    
    <style>
        /* Estilos Específicos do Wizard */
        .wizard-container { display: flex; gap: 20px; max-width: 1200px; margin: 0 auto; height: 80vh; }
        
        .wizard-main { flex: 2; display: flex; flex-direction: column; }
        .wizard-sidebar { flex: 1; background: rgba(0,255,255,0.05); border: 1px solid var(--neon-cyan); padding: 20px; overflow-y: auto; }
        
        .step-content { display: none; animation: fadeIn 0.3s; }
        .step-content.active { display: block; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .progress-bar { display: flex; gap: 5px; margin-bottom: 20px; }
        .step-indicator { flex: 1; height: 5px; background: #333; transition: 0.3s; }
        .step-indicator.active { background: var(--neon-pink); box-shadow: 0 0 10px var(--neon-pink); }
        .step-indicator.completed { background: var(--neon-cyan); }

        .control-buttons { margin-top: auto; display: flex; justify-content: space-between; padding-top: 20px; border-top: 1px solid #333; }
        
        /* Estilização dos Selects do Django para ficarem Cyberpunk */
        select, input[type="text"], input[type="number"] {
            background: #111; color: #fff; border: 1px solid #444; padding: 10px; width: 100%; margin-bottom: 10px;
        }
        select:focus, input:focus { border-color: var(--neon-cyan); outline: none; }
        
        label { color: var(--neon-cyan); font-size: 0.8em; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 5px; margin-top: 10px;}

        .guide-title { color: var(--neon-pink); font-size: 1.5em; margin-bottom: 10px; border-bottom: 1px solid var(--neon-pink); }
        .guide-text { font-size: 0.9em; line-height: 1.6; color: #ccc; }
    </style>
</head>
<body>

    <h2 class="home-title" style="text-align: center; margin-bottom: 20px;">>> PROTOCOLO DE GÊNESE</h2>

    <form method="post" enctype="multipart/form-data" id="wizard-form">
        {% csrf_token %}
        
        <div class="wizard-container">
            <div class="wizard-main">
                
                <div class="progress-bar">
                    <div class="step-indicator active" id="p1"></div>
                    <div class="step-indicator" id="p2"></div>
                    <div class="step-indicator" id="p3"></div>
                </div>

                <div class="step-content active" id="step1">
                    <h3 style="color:white; margin-bottom:20px;">1. IDENTIDADE & ORIGEM</h3>
                    
                    <div onmouseenter="updateGuide('conceito')">
                        {{ form.nome.label_tag }} {{ form.nome }}
                        {{ form.codinome.label_tag }} {{ form.codinome }}
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div onmouseenter="updateGuide('metatipo')">
                            {{ form.metatipo.label_tag }} {{ form.metatipo }}
                        </div>
                        <div onmouseenter="updateGuide('arquetipo')">
                            {{ form.arquetipo.label_tag }} {{ form.arquetipo }}
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px;" onmouseenter="updateGuide('foto')">
                        <label>AVATAR DIGITAL</label>
                        {{ form.foto }}
                    </div>
                </div>

                <div class="step-content" id="step2">
                    <h3 style="color:white; margin-bottom:20px;">2. CALIBRAÇÃO DE ATRIBUTOS</h3>
                    <p style="color:#666; font-size:0.8em;">Distribua seus níveis. Humano médio é 3. Máximo inicial é 6.</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div onmouseenter="updateGuide('fisicos')">
                            <strong style="color:var(--neon-pink)">FÍSICOS</strong>
                            {{ form.attr_corpo.label_tag }} {{ form.attr_corpo }}
                            {{ form.attr_agilidade.label_tag }} {{ form.attr_agilidade }}
                            {{ form.attr_reacao.label_tag }} {{ form.attr_reacao }}
                            {{ form.attr_forca.label_tag }} {{ form.attr_forca }}
                        </div>
                        <div onmouseenter="updateGuide('mentais')">
                            <strong style="color:#0055ff">MENTAIS</strong>
                            {{ form.attr_vontade.label_tag }} {{ form.attr_vontade }}
                            {{ form.attr_logica.label_tag }} {{ form.attr_logica }}
                            {{ form.attr_intuicao.label_tag }} {{ form.attr_intuicao }}
                            {{ form.attr_carisma.label_tag }} {{ form.attr_carisma }}
                        </div>
                    </div>
                    <div style="margin-top:15px; border-top:1px solid #333; padding-top:10px;" onmouseenter="updateGuide('especiais')">
                        <strong style="color:var(--neon-yellow)">ESPECIAIS</strong>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>{{ form.attr_trunfo.label_tag }} {{ form.attr_trunfo }}</div>
                            <div>{{ form.attr_magia.label_tag }} {{ form.attr_magia }}</div>
                        </div>
                    </div>
                </div>

                <div class="step-content" id="step3">
                    <h3 style="color:white; margin-bottom:20px;">3. PACOTE DE HABILIDADES</h3>
                    <p style="color:#666; font-size:0.8em;">Selecione suas especialidades primárias.</p>
                    
                    <div class="skill-row" style="display:flex; gap:10px; margin-bottom:10px;" onmouseenter="updateGuide('pericias')">
                        <div style="flex:3">{{ form.skill_1 }}</div>
                        <div style="flex:1">{{ form.skill_val_1 }}</div>
                    </div>
                    <div class="skill-row" style="display:flex; gap:10px; margin-bottom:10px;" onmouseenter="updateGuide('pericias')">
                        <div style="flex:3">{{ form.skill_2 }}</div>
                        <div style="flex:1">{{ form.skill_val_2 }}</div>
                    </div>
                    <div class="skill-row" style="display:flex; gap:10px; margin-bottom:10px;" onmouseenter="updateGuide('pericias')">
                        <div style="flex:3">{{ form.skill_3 }}</div>
                        <div style="flex:1">{{ form.skill_val_3 }}</div>
                    </div>
                    <div class="skill-row" style="display:flex; gap:10px; margin-bottom:10px;" onmouseenter="updateGuide('pericias')">
                        <div style="flex:3">{{ form.skill_4 }}</div>
                        <div style="flex:1">{{ form.skill_val_4 }}</div>
                    </div>

                    <div style="margin-top: 30px; text-align: center;">
                        <p style="color:var(--neon-cyan)">PRONTO PARA COMPILAR?</p>
                        <button type="submit" class="btn-submit">>> INICIAR RUNNER <<</button>
                    </div>
                </div>

                <div class="control-buttons">
                    <button type="button" class="btn-roll" id="btn-prev" onclick="changeStep(-1)" style="visibility:hidden;"> < VOLTAR</button>
                    <button type="button" class="btn-roll" id="btn-next" onclick="changeStep(1)">PRÓXIMO ></button>
                </div>
            </div>

            <div class="wizard-sidebar">
                <div id="guide-content">
                    <div class="guide-title">BEM-VINDO AO NEXUS</div>
                    <div class="guide-text">
                        Este assistente irá guiá-lo na criação do seu personagem de Shadowrun 6ª Edição.
                        <br><br>
                        Passe o mouse sobre os campos para ver explicações detalhadas extraídas do banco de dados oficial.
                    </div>
                </div>
            </div>
        </div>
    </form>

    <script>
        let currentStep = 1;
        const totalSteps = 3;

        // BANCO DE DADOS DE AJUDA (Extraído do PDF/Regras)
        const guideData = {
            'conceito': {
                title: 'IDENTIDADE',
                text: 'O <strong>Codinome</strong> é como você é conhecido nas ruas (Ex: "Razor", "Hex").<br>Nunca use seu nome real nos contatos do submundo.'
            },
            'metatipo': {
                title: 'METATIPO',
                text: 'Sua raça define seus limites físicos.<br><br><strong>Humano:</strong> Médio, ganha mais Trunfo (Edge).<br><strong>Elfo:</strong> Ágil e Carismático.<br><strong>Ork:</strong> Forte e Resistente.<br><strong>Troll:</strong> Tanque de guerra biológico.<br><strong>Anão:</strong> Resistente a toxinas e forte.'
            },
            'arquetipo': {
                title: 'ARQUÉTIPO',
                text: 'Define seu papel no time:<br><br><strong>Samurai:</strong> Combate e Armas.<br><strong>Mago:</strong> Feitiços e Espíritos.<br><strong>Decker:</strong> Hacker da Matrix.<br><strong>Face:</strong> Negociação e Social.'
            },
            'fisicos': {
                title: 'ATRIBUTOS FÍSICOS',
                text: '<strong>CORPO:</strong> Resistência a dano.<br><strong>AGILIDADE:</strong> Mira e Furtividade.<br><strong>REAÇÃO:</strong> Pilotagem e Esquiva.<br><strong>FORÇA:</strong> Dano corpo a corpo.'
            },
            'mentais': {
                title: 'ATRIBUTOS MENTAIS',
                text: '<strong>VONTADE:</strong> Resistência a magia e stun.<br><strong>LÓGICA:</strong> Hacking e Reparos.<br><strong>INTUIÇÃO:</strong> Percepção e Iniciativa.<br><strong>CARISMA:</strong> Influência social.'
            },
            'especiais': {
                title: 'ESPECIAIS',
                text: '<strong>TRUNFO (EDGE):</strong> Sua sorte e capacidade de quebrar regras.<br><strong>MÁGICA:</strong> Necessário para conjurar feitiços (Apenas Magos/Adeptos).'
            },
            'pericias': {
                title: 'PERÍCIAS',
                text: 'Escolha no que você é bom.<br><br><strong>Armas de Fogo:</strong> Uso de pistolas e fuzis.<br><strong>Furtividade:</strong> Se mover sem ser visto.<br><strong>Cracking:</strong> Quebrar firewalls.<br><strong>Influência:</strong> Convencer pessoas.'
            }
        };

        function updateGuide(key) {
            const guide = document.getElementById('guide-content');
            if(guideData[key]) {
                guide.innerHTML = `
                    <div class="guide-title">${guideData[key].title}</div>
                    <div class="guide-text">${guideData[key].text}</div>
                `;
            }
        }

        function changeStep(dir) {
            // Esconde passo atual
            document.getElementById(`step${currentStep}`).classList.remove('active');
            
            currentStep += dir;
            
            // Limites
            if(currentStep < 1) currentStep = 1;
            if(currentStep > totalSteps) currentStep = totalSteps;

            // Mostra novo passo
            document.getElementById(`step${currentStep}`).classList.add('active');
            
            // Atualiza barra
            updateProgressBar();
            
            // Atualiza Botões
            document.getElementById('btn-prev').style.visibility = currentStep === 1 ? 'hidden' : 'visible';
            
            if(currentStep === totalSteps) {
                document.getElementById('btn-next').style.display = 'none';
            } else {
                document.getElementById('btn-next').style.display = 'block';
                document.getElementById('btn-next').innerText = 'PRÓXIMO >';
            }
        }

        function updateProgressBar() {
            for(let i=1; i<=totalSteps; i++) {
                const el = document.getElementById(`p${i}`);
                if(i < currentStep) {
                    el.className = 'step-indicator completed';
                } else if (i === currentStep) {
                    el.className = 'step-indicator active';
                } else {
                    el.className = 'step-indicator';
                }
            }
        }
    </script>
</body>
</html>