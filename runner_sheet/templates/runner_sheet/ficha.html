{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runner Assistant // {{ personagem.codinome }}</title>
    
    <link rel="stylesheet" href="{% static 'runner_sheet/style.css' %}">
</head>

<body data-id="{{ personagem.id }}" 
      data-fisico="{{ personagem.dano_fisico }}" 
      data-stun="{{ personagem.dano_atordoamento }}">

    <div class="header-container">
        <div class="char-info">
            <div class="codinome">{{ personagem.codinome }}</div>
            <div class="realname">{{ personagem.nome }}</div>
            <div style="margin-top: 5px;">
                <span class="metatipo">{{ personagem.get_metatipo_display }}</span>
            </div>
        </div>
        
        <div class="char-avatar-box">
            {% if personagem.foto %}
                <img src="{{ personagem.foto.url }}" class="char-avatar-img" alt="Avatar">
            {% else %}
                <div style="width:100%; height:100%; display:flex; align-items:center; justify-content:center; color:#333; font-size:2em;">?</div>
            {% endif %}
        </div>
    </div>

    <div class="monitor-section">
        <div class="monitor-label">
            <span>MONITOR FÍSICO</span>
            <span class="btn-limpar" onclick="setDano('fisico', 0)">[RESETAR]</span>
        </div>
        <div class="track-container" id="track-fisico">
            {% with ''|center:12 as range %}
            {% for _ in range %}
                <div class="dano-box box-fisico" data-index="{{ forloop.counter }}" onclick="setDano('fisico', {{ forloop.counter }})"></div>
            {% endfor %}
            {% endwith %}
        </div>
        <br>
        <div class="monitor-label">
            <span>MONITOR STUN</span>
            <span class="btn-limpar" onclick="setDano('stun', 0)">[RESETAR]</span>
        </div>
        <div class="track-container" id="track-stun">
            {% with ''|center:12 as range %}
            {% for _ in range %}
                <div class="dano-box box-stun" data-index="{{ forloop.counter }}" onclick="setDano('stun', {{ forloop.counter }})"></div>
            {% endfor %}
            {% endwith %}
        </div>
    </div>

    <h3 class="section-title">Arsenal Conectado</h3>
    <div class="arsenal-grid">
        {% for arma in personagem.armas.all %}
        <div class="pericia-item" style="border-left-color: #ff3333;">
            <div style="flex: 1;">
                <div style="font-weight: bold; font-size: 1.1em; color: #fff;">{{ arma.nome }}</div>
                <div style="font-size: 0.8em; color: #888;">
                    Dano: <span style="color: #ff3333;">{{ arma.dano }}</span> | 
                    AP: {{ arma.ap }} | 
                    Usa: {{ arma.pericia_associada.nome }}
                </div>
            </div>
            <button class="btn-roll" 
                    style="border-color: #ff3333; color: #ff3333;"
                    onclick="rolarDados({{ arma.pericia_associada.id }}, '{{ arma.nome|escapejs }}')">
                ATIRAR
            </button>
        </div>
        {% empty %}
        <div style="color: #444; font-style: italic; margin-bottom: 20px;">Nenhuma arma linkada.</div>
        {% endfor %}
    </div>

    <div class="atributos-grid">
        {% for attr in personagem.atributos.all %}
        <div class="attr-box">
            <div class="attr-val">{{ attr.valor }}</div>
            <div class="attr-label">{{ attr.nome }}</div>
        </div>
        {% endfor %}
    </div>

    <h3 class="section-title">Programas & Perícias</h3>
    <div id="pericias-list">
        {% for pericia in personagem.pericias.all %}
        <div class="pericia-item">
            <div>
                <strong style="font-size: 1.1em;">{{ pericia.nome }}</strong> 
                <span style="color:#555; margin-left: 5px;">[{{ pericia.atributo_base }}]</span>
            </div>
            <button class="btn-roll" onclick="rolarDados({{ pericia.id }})">EXECUTAR</button>
        </div>
        {% empty %}
        <div style="color: #666; padding: 20px;">Nenhuma perícia instalada.</div>
        {% endfor %}
    </div>

    <div id="console-log">
        <div style="color: var(--neon-pink)">>> SISTEMA INICIADO...</div>
        <div style="color: var(--neon-cyan)">>> CONECTADO: {{ personagem.codinome }}</div>
        <br>
    </div>

    <script src="{% static 'runner_sheet/script.js' %}?v=3"></script>
</body>
</html>